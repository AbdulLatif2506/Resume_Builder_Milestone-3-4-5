frappe.listview_settings['DMS'] = {
    onload: function(listview) {
        listview.page.add_button(__('Search PDF Content'), function() {
            // Prompt for the search term
            frappe.prompt(
                [
                    {
                        label: 'Search Term',
                        fieldname: 'search_term',
                        fieldtype: 'Data',
                        reqd: 1
                    }
                ],
                function(values) {
                    // Call the server-side method with the search term
                    frappe.call({
                        method: 'frappe.dms.doctype.dms.api.dms_search.search_pdf_content_in_all_docs',
                        args: {
                            search_term: values.search_term
                        },
                        callback: function(r) {
                            if (r.message && r.message.length > 0) {
                                // Show the filtered list of documents in which the term was found
                                const found_docs = r.message;

                                listview.filter_area.clear();  // Clear any previous filters
                                listview.filter_area.add('DMS', 'name', 'in', found_docs);
                                listview.refresh();  // Refresh the list to show filtered results

                                frappe.msgprint(`Term found in ${found_docs.length} document(s).`);
                            } else {
                                frappe.msgprint(__('No documents found with the specified term.'));
                            }
                        }
                    });
                },
                __('Enter Search Term'),
                __('Search')
            );
        }).addClass('btn-primary');
    }
};
